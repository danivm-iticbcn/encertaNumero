<!DOCTYPE html>
<html lang="ca">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Encerta el número</title>
        <!-- Link css -->
        <link rel="stylesheet" href="/styles/style.css">
    </head>
    <body>
        <header>
            <!-- Títol -->
            <h1>Busca un número entre 1 i 20</h1>
            <!-- Botó per reiniciar el joc -->
            <div class="reiniciar-container">
                <button id="reiniciar" onclick="reiniciar()">Reinicia!</button>
            </div>
        </header>
        <main>
            <!-- SubTítol -->
            <h2>Busca el número!</h2>
            <!-- Contenidor per veure el reusltat -->
            <div id="mostrarNumero">?</div>
            <!-- Estat del joc -->
            <span id="estatPartida">Comencem la partida...</span>
        </main>
        <footer>
            <!-- Input i boto per provar -->
            <div>
                <div>
                    <input type="number" id="entradaNumero" required>
                    <button id="lanzarPrueba" onclick="probar()">Prova!</button>
                </div>
                <div id="nJudaosContainer">
                    <span id="numerosJugats"></span>
                </div>
            </div>
            <!-- Jugades i punts -->
            <div>
                <p>Jugades: <span id="jugades">20</span></p>
                <p>Total punts: <span id="puntuacio">0</span></p>
            </div>        
        </footer>
    </body>

    <script>

        //VARIABLES PARA LOGICA
        let numeroRandom = Math.floor(Math.random()*20);
        let contJugadas = 20;
        let numerosJugados = "Números jugats:  ";
        //No repetir jugados
        let numJugados = [];

        console.log(numeroRandom);

        //VARIABLES DOM (DATPS HTML)
        let mostrarNumero = document.getElementById('mostrarNumero');
        let estado = document.getElementById('estatPartida');
        let jugadas = document.getElementById('jugades');
        let puntuacion = document.getElementById('puntuacio');
        let reiniciarBtn = document.getElementById('reiniciar');
        let probarBtn = document.getElementById('lanzarPrueba');
        let numerosJugadosVista = document.getElementById('numerosJugats');

        function reiniciar(){
            //Volvemos a poner los valores como al inicio
            contJugadas = 20;
            numerosJugados = "Números jugats:  ";
            mostrarNumero.textContent = '?';
            estado.textContent = 'Comencem la partida...';
            jugadas.textContent = '20';
            numerosJugadosVista.textContent = '';
            document.body.style.backgroundColor = 'black';
            document.getElementById('entradaNumero').style.backgroundColor = 'black';

            //Cambiamos el numero a adivinar
            numeroRandom = Math.floor(Math.random()*20);
            console.log(numeroRandom);

            //Reiniciamos el input
            document.getElementById('entradaNumero').value = '';

            //Habilitamos boton probar
            probarBtn.disabled = false;
        }

        function probar(){

            //Leemos el numero introducido
            let numero = document.getElementById('entradaNumero').value;
          
            //Validamos si el valor introducido es correcto
            let esNumeroCorrecto = validarNumero(numero);

            //En caso de no ser valido avisamos
            if (numero == 'e' || !esNumeroCorrecto){
                alert('El número introduit no és correcte o ja s\'ha jugat');

            //En caso de servalido seguimos
            } else{

                //AÑADIMOS LOS NUMEROS JUGADOS
                numerosJugados += `${numero} `;
                numerosJugadosVista.textContent = numerosJugados;
                numJugados.push(numero);

                //Restamos un intento y actualizamos
                contJugadas--;
                jugadas.textContent = contJugadas;

                //Deshabilitamos el boton de reinicio
                reiniciarBtn.disabled = true;

                //En caso de ser mas grande
                if (numero > numeroRandom){
                    estado.textContent = 'El número es massa gran';
                //En caso de ser mas pequeño
                } else if(numero < numeroRandom){
                    estado.textContent = 'El número es massa petit';
                //En caso de ser el numero que buscamos
                } else if (numero == numeroRandom){ 
                    //Llamamos al final de partida
                    finalPartida(numero, reiniciarBtn);
                }
            }

            //En caso de fallar todos los intentos
            if (contJugadas == 0){
                lanzarGameOver();
            }

        }

        function validarNumero(numero){
            let esNumeroValido;
            
            //Si el numero no esta entre 0 y 20 no es valido
            if (numero < 0 || numero > 20){
                esNumeroValido = false;
            } else{
                let trobat = false;
                for (i=0; i<numJugados.length && !trobat; i++){
                    if (numero == numJugados[i]){
                        trobat = true;
                    }
                }
                esNumeroValido = !trobat;
            }

            return esNumeroValido;
        }

        function finalPartida(numero, reiniciarBtn){
            //Cambiamos estado
            estado.textContent = 'El numero és correcte';

            //Mostramos el numero
            document.getElementById('mostrarNumero').textContent = `${numero}`;

            //Miramos las jugadas y actualizamos a la mejor
            if (Number(puntuacion.textContent) == 0){
                puntuacion.textContent = contJugadas;
            } else{
                if (contJugadas > Number(puntuacion.textContent)){
                    mejorPuntuacion = contJugadas;
                    puntuacion.textContent = contJugadas;
                }
            }
            

            //Cambiamos el fondo a verde
            document.body.style.backgroundColor = 'green';
            document.getElementById('entradaNumero').style.backgroundColor = 'green';

            //Activamos el boton de reinicio
            reiniciarBtn.disabled = false;

            //Desactivamos el boton de probar
            probarBtn.disabled = true;
        }

        function lanzarGameOver(){
            //Cambiamos estado
            estado.textContent = 'Final de la partida';

            //Cambiamos el fondo a rojo
            document.body.style.backgroundColor = 'red';
            document.getElementById('entradaNumero').style.backgroundColor = 'red';

            //Activamos el boton de reinicio
            reiniciarBtn.disabled = false;

            //Desactivamos el boton de probar
            probarBtn.disabled = true;
            
        }

    </script>
</html>